---
cssclasses:
  - giovedi
aliases:
tags:
  - pullrequest
  - DevOps
  - serviceconnection
---
## Pull Request
(da ieri)
La Pull Request Ã¨ una *richiesta formale* per *unire delle modifiche di codice* da un branch a un altro (tipicamente da `develop` verso `main` ).  
Non Ã¨ solo unâ€™operazione tecnica di merge, ma un punto di controllo del processo DevOps.
In pratica:
> â€œHo fatto queste modifiche, le propongo per lâ€™integrazione. Devono essere verificate prima di entrare nel codice ufficiale.â€
---
#### ruolo della Pull Request nel DevOps
Nel contesto #DevOps, la Pull Request Ã¨ centrale perchÃ© collega:
- Sviluppo (scrittura del codice)
- qualitÃ  (review, test, standard)
- automazione (pipeline CI/CD)
- collaborazione
#### flusso tipico con Pull Request
###### 1. Creazione branch
- Il branch isola le modifiche
###### 2. Sviluppo e commit
- Commit piccoli e significativi
- Messaggi chiari
###### 3. Apertura Pull Request
Si specifica:
- cosa cambia
- perchÃ© cambia
- eventuali ticket collegati          
###### 4. Controlli automatici (CI)
- Build
- Test
###### 5. revisione del codice
- Altri sviluppatori o tech lead:
    - leggono il codice
    - commentano
	- chiedono modifiche
###### 6. merge del codice tra i vari branch
- Solo se:
    - i controlli passano
    - la review Ã¨ approvata

#### nei progetti DevOps
###### 1. riduzione degli errori
- Il codice viene visto da piÃ¹ persone
- Bug e problemi architetturali emergono prima del deploy
###### 2. qualitÃ  del codice
- Standard condivisi
- Migliore leggibilitÃ  e manutenibilitÃ 
###### 3. integrazione con le pipeline
- La pull request puÃ²:
    - bloccare il merge se la build fallisce
    - impedire il deploy di codice instabile
*â€œse non passa la pipeline, non entraâ€*
###### 4. tracciabilitÃ 
- Ogni modifica Ã¨:
    - documentata
    - collegabile a un ticket
    - auditabile (chi ha fatto cosa e perchÃ©)
###### 5. collaborazione e responsabilitÃ 
- Le decisioni sul codice sono condivise
---
#### Pull Request e ambienti
In un progetto DevOps strutturato la pull request puÃ² essere utilizzata
- verso develop â†’ ambiente Dev
- verso release â†’ ambiente Test 
- verso main â†’ Produzione
Questo permette:
- controlli progressivi
- meno rischi in produzione
---
#### modalitÃ 
- Pull request piccole (facili da capire e revisionare)
- Descrizione chiara 
- Non bypassare la pipeline
- Review come parte del lavoro, non come perdita di tempo
---
#### utilitÃ 
La Pull Request non serve solo a unire codice ma a:
> proteggere il progetto, automatizzare i controlli e migliorare il lavoro di squadra
In DevOps, la PR Ã¨ uno dei principali strumenti per trasformare il codice da â€œfunziona sul mio PCâ€ a "software affidabile e distribuibile"



## VVF_AFM_PartNumbers
errore pipeline paccetti nuget..
classico da pipeline Linux che eredita configurazioni Windows**. Ti spiego cosa sta succedendo e come lo sistemi in modo pulito, senza workaround fragili.

#### Cosa sta succedendo davvero
La pipeline gira su **`ubuntu-latest`**, quindi su **Linux**.  
Durante il **restore NuGet**, perÃ², NuGet sta leggendo **fonti locali Windows**:

- `C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\`
    
- `J:\Progetti\VVF\src\NugetLocalFeed_AFM`
    

Su Linux questi path **non possono esistere**, e infatti NuGet li â€œtraduceâ€ male in:

```
/home/vsts/work/1/s/C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\
```

Risultato: `NU1301 â€“ local source doesn't exist`.

Quindi **non Ã¨ un problema di NuGet online**, ma di **configurazione delle fonti**.

---

#### Da dove arrivano quelle fonti?

Arrivano quasi certamente da **uno di questi punti** (in ordine di probabilitÃ ):
3. Configurazione NuGet dellâ€™ambiente di sviluppo Windows (poi committata)
4. Riferimenti legacy tipo `RestoreSources` nei `.csproj`

Dato che lâ€™errore cita la `.sln`, il restore sta usando un `NuGet.config` custom**.

---
### Verifica

Nel repo cerca:

```
NuGet.config
```

e controlla se trovi qualcosa del genere:

```xml
<packageSources>
  <add key="LocalSdk" value="C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\" />
  <add key="LocalFeed" value="J:\Progetti\VVF\src\NugetLocalFeed_AFM" />
</packageSources>
```

Se sÃ¬ â†’ **questa Ã¨ la causa**.

---

### Soluzione corretta (consigliata)

#### Opzione 1 â€“ NuGet.config â€œcross-platformâ€

Modifica `NuGet.config` **rimuovendo le fonti locali Windows**, e lascia solo quelle valide in pipeline:

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <packageSources>
    <clear />
    <add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
  </packageSources>
</configuration>
```

Questa Ã¨ la soluzione **piÃ¹ pulita e DevOps-friendly**.

---

### Se davvero ti serve un feed privato

Se `NugetLocalFeed_AFM` serve solo **in locale**:

- **non deve stare nel repo**
    
- oppure va gestito con **conditional config**
    

Esempio avanzato (se proprio serve):

```xml
<packageSources>
  <add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
</packageSources>

<packageSourceMapping>
  <!-- mapping opzionale -->
</packageSourceMapping>
```

E in locale usi un `NuGet.config` **user-level**, non versionato.

---

### Workaround temporaneo (non ideale, ma utile per sbloccare)

Se non puoi toccare subito il repo, puoi forzare le sorgenti in pipeline:

```yaml
- script: |
    dotnet restore VVF.AFM.PartNumbers.sln \
      --source https://api.nuget.org/v3/index.json
  displayName: Restore NuGet (forced source)
```

âš ï¸ PerÃ²:

- ignora il `NuGet.config`
    
- va bene solo come emergenza
    

---

### Riassunto secco

- âŒ Errore **non** di NuGet.org
    
- âŒ Errore **non** di SDK .NET
    
- âœ… Ãˆ un **NuGet.config Windows portato su Linux**
    
- âœ… Soluzione: **rimuovere path locali Windows dal repo**
    
- âœ… Pipeline Linux â†’ solo feed HTTP(S)
    

Se vuoi, nel prossimo messaggio puoi **incollarmi il tuo `NuGet.config`** e te lo sistemo riga per riga, pronto sia per locale che per pipeline.




### 1ï¸. Primo posto da controllare (il piÃ¹ probabile)

**Nella root del repository**, allo stesso livello della `.sln`.

Cerca un file chiamato **`NuGet.config`** qui:

```
VVF.AFM.PartNumbers/
â”œâ”€ VVF.AFM.PartNumbers.sln
â”œâ”€ NuGet.config   ğŸ‘ˆ QUI
â”œâ”€ VVF.AFM.PartNumbers.API/
â”œâ”€ VVF.AFM.PartNumbers.Application/
â”œâ”€ ...
```

Aprilo e guarda se dentro câ€™Ã¨ una sezione tipo:

```xml
<packageSources>
  <add key="LocalSdk" value="C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\" />
  <add key="LocalFeed" value="J:\Progetti\VVF\src\NugetLocalFeed_AFM" />
</packageSources>
```

ğŸ‘‰ Se lo trovi **qui**, hai giÃ  spiegato tutto lâ€™errore della pipeline.

---

### 2ï¸.  Secondo posto da controllare

Dentro **una sottocartella di progetto**, ad esempio:

```
VVF.AFM.PartNumbers.API/NuGet.config
VVF.AFM.PartNumbers.Application/NuGet.config
```

Meno comune, ma capita.

---

### 3ï¸. Controllo rapido (il piÃ¹ veloce)

Se vuoi fare **search brutale** (consigliato):

Cerca nel repo queste stringhe:

```
NuGetPackages
NugetLocalFeed_AFM
J:\
C:\Program Files
```

Appena una di queste compare in un `NuGet.config`, hai trovato il colpevole.

---

### 4ï¸- Cosa NON Ã¨ (cosÃ¬ non perdi tempo)

 Non Ã¨:

- Azure DevOps
    
- la pipeline YAML
    
- il task NuGet
    
- la VM `ubuntu-latest`
    

Il log lo conferma: NuGet sta leggendo **configurazione locale Windows versionata**.

---

### 5. Cosa devi fare appena lo trovi

Se il progetto **non usa feed privati**, il file corretto deve essere cosÃ¬:

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <packageSources>
    <clear />
    <add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
  </packageSources>
</configuration>
```

Commit â†’ pipeline riparte.

---

Se vuoi, al prossimo messaggio puoi:

- incollarmi **il contenuto del `NuGet.config`**
    
- oppure dirmi **â€œnon lo trovoâ€** e ti dico esattamente **come capire da quale progetto lo sta ereditando**
    

Qui il problema Ã¨ tecnico ma semplice: stai solo **portando dietro Windows in Linux**.


---

### Punto chiave (da capire bene)

`dotnet restore` **non usa solo quello che vede nel repository**.  
Per design, NuGet carica **piÃ¹ livelli di configurazione**, in questo ordine:

1. NuGet.config nella cartella del progetto
    
2. NuGet.config nella root del repo
    
3. NuGet.config â€œdi sistemaâ€ dellâ€™SDK
    
4. **NuGet.config utente (GLOBAL)**
    

Nel tuo caso sta succedendo il punto 4.

---

### PerchÃ© compaiono path Windows su una VM Linux?

Quelle voci:

```
C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\
J:\Progetti\VVF\src\NugetLocalFeed_AFM
```

sono **tipiche di un ambiente Visual Studio Windows**.

Quando la pipeline esegue:

```yaml
dotnet restore
```

NuGet:

- non trova un `NuGet.config` nel repo
    
- allora **usa quello globale**
    
- quel config contiene **path Windows**
    
- su Linux quei path diventano â€œrelativiâ€ â†’ errore `NU1301`
    

Ecco perchÃ© nel log vedi:

```
/home/vsts/work/1/s/C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\
```

---

### Prova che lo conferma (importantissima)

Guarda questo step della tua pipeline:

```yaml
- script: |
    dotnet nuget list source
```

Se guardi lâ€™output completo, **lÃ¬ dentro vedrai quelle due sorgenti Windows**.  
Quella Ã¨ la prova definitiva che **NuGet le sta caricando da fuori repo**.

---

### QUINDI: cosa devi fare (soluzione corretta)

### âœ… Soluzione DEVOPS corretta (1 file, problema finito)

**Aggiungi un `NuGet.config` nella root del repository**, anche se prima non câ€™era.

Contenuto MINIMO:

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <packageSources>
    <clear />
    <add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
  </packageSources>
</configuration>
```

ğŸ“Œ Questo fa una cosa fondamentale:

- **azzera tutte le sorgenti globali**
    
- usa solo nuget.org
    
- rende la pipeline **deterministica**
    
- funziona su Linux, Windows, agent self-hosted, tutto
    

Commit â†’ pipeline riparte.

---

### PerchÃ© questa Ã¨ la soluzione â€œgiustaâ€

- Non dipendi da configurazioni nascoste dellâ€™agent
    
- Non erediti roba Windows
    
- Non servono workaround in YAML
    
- Ãˆ best practice DevOps (pipeline riproducibile)
    

---

### Alternative (meno consigliate)

###  Forzare il restore in pipeline (workaround)

```yaml
- script: |
    dotnet restore VVF.AFM.PartNumbers.sln \
      --source https://api.nuget.org/v3/index.json
```

Funziona, ma:

- ignora config
    
- piÃ¹ fragile
    
- meno pulito
    

---

### nuget.config
Nel `NuGet.config` câ€™Ã¨ questa riga:
```
<add key="Microsoft Visual Studio Offline Packages" value="C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\" />
```
che funziona solo su Windows con Visual Studio installato
nella pipeline: 
`vmImageName: 'ubuntu-latest'`
Quindi: linux, che non ha C:\ quindi quella sorgente non puÃ² esistere

ora Ã¨:
```
<?xmlÂ version="1.0"Â encoding="utf-8"?>
<configuration>
Â Â <packageSources>
Â Â Â Â <clearÂ />
Â Â Â Â <addÂ key="vvf-afm-common-feed"Â 
		value="https://pkgs.dev.azure.com/Leonardo-Cybersecurity/AFM-VVF/_packaging/vvf-afm-common-feed/nuget/v3/index.json"Â />
Â Â Â Â <addÂ key="nuget.org"Â 
		value="https://api.nuget.org/v3/index.json"Â />
Â Â Â Â <addÂ key="MicrosoftÂ VisualÂ StudioÂ OfflineÂ Packages"Â value="C:\ProgramÂ FilesÂ (x86)\MicrosoftÂ SDKs\NuGetPackages\"Â />
Â Â </packageSources>
</configuration>
```

va eliminata la riga 
```
<addÂ key="MicrosoftÂ VisualÂ StudioÂ OfflineÂ Packages"Â value="C:\ProgramÂ FilesÂ (x86)\MicrosoftÂ SDKs\NuGetPackages\"Â />
```

la prima versione era:
```
<?xmlÂ version="1.0"Â encoding="utf-8"?>
<configuration>
Â Â <packageSources>
Â Â Â Â <clearÂ />
Â Â Â Â <addÂ key="vvf-afm-common-feed"Â 
		value="https://pkgs.dev.azure.com/Leonardo-Cybersecurity/AFM-VVF/_packaging/vvf-afm-common-feed/nuget/v3/index.json"Â />
Â Â </packageSources>
</configuration>
```
incompleta e incompatibile con l'ultimo merge.




## VVF_AFM_Reports
### risoluzione licenza telerik per Report
forse
la pipeline ha girato? non esattamente:
problema con la [[2025-12-16#licenza telerik|licenza telerik]]



vedi dockerfile
#workdir 

